(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["wrie"],{"091e":function(e,t,i){"use strict";i("b2fe")},b2fe:function(e,t,i){},ed6a:function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("nav-bar",{attrs:{subtitle:"写文章"}}),t("div",{staticClass:"content"},[t("div",{staticClass:"help"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("帮助")]),t("el-dialog",{attrs:{title:"帮助",modal:!1,visible:e.dialogVisible,width:e.mobile?"95%":"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",[t("ul",{staticStyle:{color:"#e83e8c"}},[t("li",[e._v("当你切换页面时，草稿会存到浏览器缓存里 (并不保险)")]),t("br"),t("li",[e._v("文章标题为2-30个字")]),t("br"),t("li",[e._v("文章二级分类（可选）为自定义标签，最多定义4个")]),t("br"),t("li",[e._v("题图（可选）图片会展示在首页右侧缩略图和文章开头")]),t("br"),t("li",[e._v("所有图片建议比例为2:3至3:2之间，大小不能超过2MB")])])]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)])],1),t("div",{staticClass:"xieyi"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){e.dialogVisible1=!0}}},[e._v("用户协议")]),t("el-dialog",{attrs:{title:"用户协议",modal:!1,visible:e.dialogVisible1,width:e.mobile?"95%":"50%"},on:{"update:visible":function(t){e.dialogVisible1=t}}},[t("div",[t("ul",{staticStyle:{color:"#e83e8c"}},[t("li",[e._v("用户不得发布色情，暴力等各种法律禁止的内容")]),t("br"),t("li",[e._v("用户在本站发布的文章，管理者有权力建议修改，修改，删除其中内容，使得文章符合规范")]),t("br"),t("li",[e._v("转载等文章需符合转载规范")])])]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible1=!1}}},[e._v("确 定")])],1)])],1),t("el-form",{ref:"ruleForm",attrs:{"label-position":e.mobile?"top":"left",model:e.form,"label-width":"80px",rules:e.rules}},[t("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[t("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"文章分类",prop:"category"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.category.value,callback:function(t){e.$set(e.form.category,"value",t)},expression:"form.category.value"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"二级分类"}},[e._l(e.form.category.children,(function(i,l){return t("el-tag",{key:l,attrs:{closable:"","disable-transitions":!1},on:{close:function(t){return e.handleClose(i)}}},[e._v(e._s(i))])})),e.inputVisible?t("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small",disabled:4==e.form.category.children.length},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm.apply(null,arguments)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):t("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ New Tag")])],2),t("el-form-item",{attrs:{label:"添加题图"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:3000/server/api/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.form.icon?t("img",{staticClass:"useravatar",attrs:{src:e.form.icon}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t("el-form-item",{attrs:{label:"文章内容",prop:"content","label-width":"80px"}},[t("vue-editor",{attrs:{useCustomImageHandler:""},on:{"image-added":e.handleImageAdded},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("立即发布")]),t("el-button",{staticStyle:{float:"right"},on:{click:e.cancle}},[e._v("清空")])],1)],1)],1)],1)},a=[],o=(i("14d9"),i("d000")),r=i("5873"),s={name:"Write",data(){return{mobile:!1,dialogVisible:!1,dialogVisible1:!1,rules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:2,max:30,message:"标题长度为2-30个字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"},{min:15,message:"文章内容不少于15个字",trigger:"blur"}]},options:[{value:"IT技术",label:"IT技术"},{value:"校园生活",label:"校园生活"},{value:"经验分享",label:"经验分享"},{value:"论坛提问",label:"论坛提问"}],inputVisible:!1,inputValue:"",form:{category:{value:"IT技术",children:[]},title:"",content:"",icon:""},logined:!0}},methods:{cancle(){this.$confirm("确定清空当前内容和草稿?","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.form.icon="",localStorage.form="",this.$refs.ruleForm.resetFields()}).catch(()=>{})},handleClose(e){this.form.category.children.splice(this.form.category.children.indexOf(e))},showInput(){this.inputVisible=!0,this.$nextTick(e=>{this.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm(){let e=this.inputValue;e&&this.form.category.children.push(e),this.inputVisible=!1,this.inputValue=""},handleAvatarSuccess(e){this.form.icon=e.url},beforeAvatarUpload(e){const t="image/jpeg"===e.type||"image/png"===e.type,i=e.size/1024/1024<=2;return t||this.$message.error("上传头像图片只能是 JPG或者PNG 格式!"),i||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&i},async onSubmit(){this.$refs.ruleForm.validate(async e=>{e&&this.$confirm("确定发布?","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{this.form.time=(new Date).getTime();await this.$http.post("/",this.form);this.$message.success("发布成功"),this.form.icon="",localStorage.form="",this.$refs.ruleForm.resetFields(),this.$router.push("/")}).catch(()=>{})})},async handleImageAdded(e,t,i,l){if(e.size>=2306867.2)this.$message.error("图片大小不能超过2MB");else if("image/jpeg"!=e.type&&"image/jpg"!=e.type&&"image/png"!=e.type)this.$message.error("图片必须是JPG或者PNG格式");else{const a=new FormData;a.append("file",e);const o=await this.$http.post("upload",a);t.insertEmbed(i,"image",o.data.url),l()}}},components:{NavBar:o["a"],VueEditor:r["a"]},created(){window.innerWidth<=700?(this.mobile=!0,this.$message.warning("不建议在移动端发布或者修改文章")):this.mobile=!1},mounted(){localStorage.form&&(this.form=JSON.parse(localStorage.form))},beforeRouteLeave(e,t,i){(this.form.title||this.form.content)&&window.localStorage.setItem("form",JSON.stringify(this.form)),i()}},n=s,c=(i("091e"),i("2877")),u=Object(c["a"])(n,l,a,!1,null,"040d04cc",null);t["default"]=u.exports}}]);