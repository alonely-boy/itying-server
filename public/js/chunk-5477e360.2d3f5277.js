(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5477e360"],{"2d94":function(t,e,i){},c5dc:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"article"},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"user"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.writer.avatar}})]),i("div",{staticClass:"name"},[t._v(t._s(t.writer.userName))]),t.$store.state.admin?i("div",{staticStyle:{float:"right"}},[i("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"edit",attrs:{type:"text"},on:{click:t.editClick}},[i("i",{staticClass:"el-icon-edit"}),t._v("编辑 ")]),i("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"delete",attrs:{type:"text"},on:{click:t.deleteClick}},[i("i",{staticClass:"el-icon-delete"}),t._v("删除 ")])],1):i("div",{staticStyle:{float:"right"}},[i("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"agree",attrs:{type:"text"},on:{click:t.agreeClick}},[i("i",{staticClass:"el-icon-caret-top"}),t._v("点赞 ")]),i("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"star",attrs:{type:"text"},on:{click:t.starClick}},[i("i",{staticClass:"el-icon-star-on"}),t._v("收藏 ")])],1)]),i("div",{staticClass:"title"},[t._v(t._s(t.article.title))]),i("div",{staticClass:"subtitle"},[i("div",{staticClass:"categorys"},[i("div",{staticClass:"category"},[t._v(t._s(t.article.category.value))]),t._l(t.article.category.children,(function(e,r){return i("div",{key:r,staticClass:"category"},[t._v(t._s(e))])}))],2),i("div",{staticClass:"time"},[t._v("发布于 "+t._s(t._f("dateFormat")(t.article.time)))])]),t.article.icon?i("div",{staticClass:"icon"},[i("img",{attrs:{src:t.article.icon,alt:""}})]):t._e(),i("div",{staticClass:"content",domProps:{innerHTML:t._s(t.article.content)}})]),i("el-card",{staticClass:"comment-card"},[i("div",{staticClass:"path"},[t._v(" "+t._s(t.article.comment.length)+"条评论 "),i("div",{staticClass:"path-comment"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.huifu(!1)}}},[t._v("添加评论")])],1)]),i("div",{staticClass:"comment"},t._l(t.article.comment,(function(e,r){return i("div",{staticClass:"comment-content"},[i("div",{staticClass:"left"},[i("img",{attrs:{src:e.user.avatar,alt:"",width:"40px",height:"100%"}})]),i("div",{staticClass:"right"},[i("div",{staticClass:"content"},[i("span",{staticClass:"name"},[t._v(t._s(e.user.userName)+" :")]),t._v(" "+t._s(e.content)+" "),i("div",{staticClass:"footer"},[i("div",{staticClass:"huifu",on:{click:function(i){return t.huifu(e,r)}}},[t._v("回复")]),t._v("· "),t.judge1(e.user._id)?i("div",{staticClass:"remove",on:{click:function(i){return t.remove(e,r)}}},[t._v("删除 ·")]):t._e(),i("div",{staticClass:"time"},[t._v(t._s(t._f("dateFormat")(e.time)))])]),i("div",{staticClass:"children"},[i("div",{staticClass:"class"}),t._l(e.children,(function(a,n){return i("div",{staticClass:"item"},[i("span",{staticClass:"name"},[t._v(t._s(a.user.userName)+" :")]),t._v(" "+t._s(a.content)+" "),i("div",{staticClass:"footer"},[i("div",{staticClass:"huifu",on:{click:function(e){return t.huifu(a,r)}}},[t._v("回复")]),t._v("· "),t.judge2(e.user._id,a.user._id)?i("div",{staticClass:"remove",on:{click:function(e){return t.remove(a,r,n)}}},[t._v("删除 ·")]):t._e(),i("div",{staticClass:"time"},[t._v(t._s(t._f("dateFormat")(a.time)))])])])}))],2)])])])})),0)]),i("el-dialog",{attrs:{title:"添加评论",visible:t.dialogFormVisible,"close-on-click-modal":!1,"before-close":t.commentClose},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"commentForm",attrs:{model:t.comment,rules:t.rules}},[i("el-form-item",{attrs:{prop:"value"}},[i("el-input",{attrs:{maxlength:"160",type:"textarea",autosize:{minRows:2,maxRows:8},"show-word-limit":"",autocomplete:"off"},model:{value:t.comment.value,callback:function(e){t.$set(t.comment,"value",e)},expression:"comment.value"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.commentClose}},[t._v("取 消")]),i("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],attrs:{type:"primary"},on:{click:t.commentClick}},[t._v("确 定")])],1)],1)],1)},a=[],n=(i("fb6a"),i("96cf"),i("1da1")),s={name:"Article",data:function(){return{removeObj:{},huifuObj:{},dialogFormVisible:!1,comment:{value:""},rules:{value:[{required:!0,message:"请输入内容",trigger:"blur"},{min:2,message:"内容不少于2个字符",trigger:"blur"}]},article:{category:{value:"",children:[]},comment:[]},writer:{}}},created:function(){this.test()},methods:{deleteClick:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$confirm("确定以管理员的身份强制删除这篇文章?","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function e(){var i,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.$route.path.slice(8),e.next=3,t.$http.delete("/edit".concat(i));case 3:r=e.sent,a=r.data,"ok"==a&&(t.$message.success("删除成功"),t.$router.push("/"));case 6:case"end":return e.stop()}}),e)})))).catch((function(){}));case 1:case"end":return e.stop()}}),e)})))()},editClick:function(){var t=this.$route.path.slice(8);this.$router.push("/edit".concat(t))},agreeClick:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.put("/agree",{id:t.article._id});case 2:i=e.sent,"已经点赞过了"==i.data?t.$message.warning(i.data):t.$message.success(i.data);case 4:case"end":return e.stop()}}),e)})))()},starClick:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.put("/star",{id:t.article._id});case 2:i=e.sent,"已经收藏过了"==i.data?t.$message.warning(i.data):t.$message.success(i.data);case 4:case"end":return e.stop()}}),e)})))()},judge1:function(t){var e=this.$store.state.admin||localStorage.id==this.article.writer._id||localStorage.id==t;return e},judge2:function(t,e){return this.$store.state.admin||localStorage.id==this.article.writer._id||localStorage.id==t||localStorage.id==e},test:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("".concat(t.$route.path));case 2:return i=e.sent,t.article=i.data,t.writer=i.data.writer,e.next=7,t.$http.post("/comment",i.data.comment);case 7:r=e.sent,t.article.comment=r.data;case 9:case"end":return e.stop()}}),e)})))()},huifu:function(t,e){localStorage.token?t?t.children?(this.dialogFormVisible=!0,this.huifuObj.children=!0,this.huifuObj.index=e):(this.dialogFormVisible=!0,this.comment.value="@"+t.user.userName+": ",this.huifuObj.children=!0,this.huifuObj.index=e):(this.dialogFormVisible=!0,this.huifuObj.children=!1):this.$router.push("/login")},remove:function(t,e,i){var r=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r.$confirm("确定删除该评论?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.children?(r.removeObj.index=e,r.removeObj.children=!1,r.removeObj.id=t.id,r.removeObj.pid=r.article._id,r.removeObj.user=localStorage.id):(r.removeObj.index=i,r.removeObj.children=!0,r.removeObj.motherIndex=e,r.removeObj.id=t.id,r.removeObj.pid=r.article._id,r.removeObj.user=localStorage.id),a.next=3,r.$http.post("/commentdelete",r.removeObj);case 3:a.sent,r.$message({type:"success",message:"删除成功!"}),r.test();case 6:case"end":return a.stop()}}),a)})))).catch((function(){}));case 1:case"end":return a.stop()}}),a)})))()},commentClick:function(){var t=this;this.$refs.commentForm.validate(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(i){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=8;break}return r={commentTo:t.article._id,content:t.comment.value,time:(new Date).getTime(),huifuobj:t.huifuObj},e.next=4,t.$http.put("/comment",r);case 4:t.test(),t.commentClose(),e.next=9;break;case 8:return e.abrupt("return");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},commentClose:function(){this.commentTo="",this.comment.value="",this.huifuObj={},this.dialogFormVisible=!1}}},c=s,o=(i("cef1"),i("2877")),l=Object(o["a"])(c,r,a,!1,null,"5cf0d598",null);e["default"]=l.exports},cef1:function(t,e,i){"use strict";var r=i("2d94"),a=i.n(r);a.a},fb6a:function(t,e,i){"use strict";var r=i("23e7"),a=i("861d"),n=i("e8b5"),s=i("23cb"),c=i("50c4"),o=i("fc6a"),l=i("8418"),u=i("b622"),m=i("1dde"),d=i("ae40"),v=m("slice"),h=d("slice",{ACCESSORS:!0,0:0,1:2}),f=u("species"),p=[].slice,g=Math.max;r({target:"Array",proto:!0,forced:!v||!h},{slice:function(t,e){var i,r,u,m=o(this),d=c(m.length),v=s(t,d),h=s(void 0===e?d:e,d);if(n(m)&&(i=m.constructor,"function"!=typeof i||i!==Array&&!n(i.prototype)?a(i)&&(i=i[f],null===i&&(i=void 0)):i=void 0,i===Array||void 0===i))return p.call(m,v,h);for(r=new(void 0===i?Array:i)(g(h-v,0)),u=0;v<h;v++,u++)v in m&&l(r,u,m[v]);return r.length=u,r}})}}]);