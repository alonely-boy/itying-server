(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a024cf8a"],{"6a46":function(t,e,i){"use strict";i("7ebd")},"7ebd":function(t,e,i){},c5dc:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"user"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.writer.avatar}})]),e("div",{staticClass:"name"},[t._v(t._s(t.writer.userName))]),t.$store.state.admin?e("div",{staticClass:"ope",staticStyle:{float:"right"}},[e("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"edit",attrs:{type:"text"},on:{click:t.editClick}},[e("i",{staticClass:"el-icon-edit"}),t._v("编辑 ")]),e("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"delete",attrs:{type:"text"},on:{click:t.deleteClick}},[e("i",{staticClass:"el-icon-delete"}),t._v("删除 ")])],1):e("div",{staticClass:"ope",staticStyle:{float:"right"}},[e("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"agree",attrs:{type:"text"},on:{click:t.agreeClick}},[e("i",{staticClass:"el-icon-caret-top"}),t._v("点赞 ")]),e("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],staticClass:"star",attrs:{type:"text"},on:{click:t.starClick}},[e("i",{staticClass:"el-icon-star-on"}),t._v("收藏 ")])],1)]),e("div",{staticClass:"title1"},[t._v(t._s(t.article.title))]),e("div",{staticClass:"subtitle1"},[e("div",{staticClass:"categorys"},[e("div",{staticClass:"category"},[t._v(t._s(t.article.category.value))]),t._l(t.article.category.children,(function(i,s){return e("div",{key:s,staticClass:"category"},[t._v(t._s(i))])}))],2),e("div",{staticClass:"time"},[t._v("发布于 "+t._s(t._f("dateFormat")(t.article.time)))])]),t.article.icon?e("div",{staticClass:"icon"},[e("img",{attrs:{src:t.article.icon,alt:""}})]):t._e(),e("div",{staticClass:"content",domProps:{innerHTML:t._s(t.article.content)}})]),e("el-card",{staticClass:"comment-card"},[e("div",{staticClass:"path"},[t._v(" "+t._s(t.article.comment.length)+"条评论 "),e("div",{staticClass:"path-comment"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.huifu(!1)}}},[t._v("添加评论")])],1)]),e("div",{staticClass:"comment"},t._l(t.article.comment,(function(i,s){return e("div",{staticClass:"comment-content"},[e("div",{staticClass:"left1"},[e("img",{attrs:{src:i.user.avatar,alt:"",width:"40px",height:"100%"}})]),e("div",{staticClass:"right"},[e("div",{staticClass:"content"},[e("span",{staticClass:"name"},[t._v(t._s(i.user.userName)+" :")]),t._v(" "+t._s(i.content)+" "),e("div",{staticClass:"footer"},[e("div",{staticClass:"huifu",on:{click:function(e){return t.huifu(i,s)}}},[t._v("回复")]),t._v("· "),t.judge1(i.user._id)?e("div",{staticClass:"remove",on:{click:function(e){return t.remove(i,s)}}},[t._v("删除 ·")]):t._e(),e("div",{staticClass:"time"},[t._v(t._s(t._f("dateFormat")(i.time)))])]),e("div",{staticClass:"children"},[e("div",{staticClass:"class"}),t._l(i.children,(function(a,c){return e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v(t._s(a.user.userName)+" :")]),t._v(" "+t._s(a.content)+" "),e("div",{staticClass:"footer"},[e("div",{staticClass:"huifu",on:{click:function(e){return t.huifu(a,s)}}},[t._v("回复")]),t._v("· "),t.judge2(i.user._id,a.user._id)?e("div",{staticClass:"remove",on:{click:function(e){return t.remove(a,s,c)}}},[t._v("删除 ·")]):t._e(),e("div",{staticClass:"time"},[t._v(t._s(t._f("dateFormat")(a.time)))])])])}))],2)])])])})),0)]),e("el-dialog",{attrs:{title:"添加评论",visible:t.dialogFormVisible,"close-on-click-modal":!1,"before-close":t.commentClose,width:t.mobile?"95%":"500px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{ref:"commentForm",attrs:{model:t.comment,rules:t.rules}},[e("el-form-item",{attrs:{prop:"value"}},[e("el-input",{attrs:{maxlength:"160",type:"textarea",autosize:{minRows:2,maxRows:8},"show-word-limit":"",autocomplete:"off"},model:{value:t.comment.value,callback:function(e){t.$set(t.comment,"value",e)},expression:"comment.value"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.commentClose}},[t._v("取 消")]),e("el-button",{directives:[{name:"preventClick",rawName:"v-preventClick"}],attrs:{type:"primary"},on:{click:t.commentClick}},[t._v("确 定")])],1)],1)],1)},a=[],c=(i("14d9"),{name:"Article",data(){return{mobile:!1,removeObj:{},huifuObj:{},dialogFormVisible:!1,comment:{value:""},rules:{value:[{required:!0,message:"请输入内容",trigger:"blur"},{min:2,message:"内容不少于2个字符",trigger:"blur"}]},article:{category:{value:"",children:[]},comment:[]},writer:{}}},created(){this.test(),window.innerWidth<=700?(this.mobile=!0,window.scrollTo({top:20,behavior:"smooth"})):this.mobile=!1},methods:{async deleteClick(){this.$confirm("确定以管理员的身份强制删除这篇文章?","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let t=this.$route.path.slice(8);const{data:e}=await this.$http.delete("/edit"+t);"ok"==e&&(this.$message.success("删除成功"),this.$router.push("/"))}).catch(()=>{})},editClick(){let t=this.$route.path.slice(8);this.$router.push("/edit"+t)},async agreeClick(){const t=await this.$http.put("/agree",{id:this.article._id});"已经点赞过了"==t.data?this.$message.warning(t.data):this.$message.success(t.data)},async starClick(){const t=await this.$http.put("/star",{id:this.article._id});"已经收藏过了"==t.data?this.$message.warning(t.data):this.$message.success(t.data)},judge1(t){var e=this.$store.state.admin||localStorage.id==this.article.writer._id||localStorage.id==t;return e},judge2(t,e){return this.$store.state.admin||localStorage.id==this.article.writer._id||localStorage.id==t||localStorage.id==e},async test(){const t=await this.$http.get(""+this.$route.path);this.article=t.data,this.writer=t.data.writer;const e=await this.$http.post("/comment",t.data.comment);this.article.comment=e.data},huifu(t,e){localStorage.token?t?t.children?(this.dialogFormVisible=!0,this.huifuObj.children=!0,this.huifuObj.index=e):(this.dialogFormVisible=!0,this.comment.value="@"+t.user.userName+": ",this.huifuObj.children=!0,this.huifuObj.index=e):(this.dialogFormVisible=!0,this.huifuObj.children=!1):this.$router.push("/login")},async remove(t,e,i){this.$confirm("确定删除该评论?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{t.children?(this.removeObj.index=e,this.removeObj.children=!1,this.removeObj.id=t.id,this.removeObj.pid=this.article._id,this.removeObj.user=localStorage.id):(this.removeObj.index=i,this.removeObj.children=!0,this.removeObj.motherIndex=e,this.removeObj.id=t.id,this.removeObj.pid=this.article._id,this.removeObj.user=localStorage.id);await this.$http.post("/commentdelete",this.removeObj);this.$message({type:"success",message:"删除成功!"}),this.test()}).catch(()=>{})},commentClick(){this.$refs.commentForm.validate(async t=>{if(t){let t={commentTo:this.article._id,content:this.comment.value,time:(new Date).getTime(),huifuobj:this.huifuObj};await this.$http.put("/comment",t),this.test(),this.commentClose()}})},commentClose(){this.commentTo="",this.comment.value="",this.huifuObj={},this.dialogFormVisible=!1}}}),r=c,l=(i("6a46"),i("2877")),o=Object(l["a"])(r,s,a,!1,null,null,null);e["default"]=o.exports}}]);