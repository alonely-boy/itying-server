(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c2d4f38"],{1071:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("nav-bar",{attrs:{subtitle:"写文章"}}),e("div",{staticClass:"content"},[e("div",{staticClass:"help"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("帮助")]),e("el-dialog",{attrs:{title:"帮助",modal:!1,visible:t.dialogVisible,width:t.mobile?"95%":"50%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",[e("ul",{staticStyle:{color:"#e83e8c"}},[e("li",[t._v("当你切换页面时，草稿会存到浏览器缓存里 (并不保险)")]),e("br"),e("li",[t._v("文章标题为2-30个字")]),e("br"),e("li",[t._v("文章二级分类（可选）为自定义标签，最多定义4个")]),e("br"),e("li",[t._v("题图（可选）图片会展示在首页右侧缩略图和文章开头")]),e("br"),e("li",[t._v("所有图片建议比例为2:3至3:2之间，大小不能超过2MB")])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 定")])],1)])],1),e("div",{staticClass:"xieyi"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){t.dialogVisible1=!0}}},[t._v("用户协议")]),e("el-dialog",{attrs:{title:"用户协议",modal:!1,visible:t.dialogVisible1,width:t.mobile?"95%":"50%"},on:{"update:visible":function(e){t.dialogVisible1=e}}},[e("div",[e("ul",{staticStyle:{color:"#e83e8c"}},[e("li",[t._v("用户不得发布色情，暴力等各种法律禁止的内容")]),e("br"),e("li",[t._v("用户在本站发布的文章，管理者有权力建议修改，修改，删除其中内容，使得文章符合规范")]),e("br"),e("li",[t._v("转载等文章需符合转载规范")])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible1=!1}}},[t._v("确 定")])],1)])],1),e("el-form",{ref:"ruleForm",attrs:{"label-position":t.mobile?"top":"left",model:t.form,"label-width":"80px",rules:t.rules}},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:"文章分类",prop:"category"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.category.value,callback:function(e){t.$set(t.form.category,"value",e)},expression:"form.category.value"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"二级分类"}},[t._l(t.form.category.children,(function(i,a){return e("el-tag",{key:a,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.handleClose(i)}}},[t._v(t._s(i))])})),t.inputVisible?e("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small",disabled:4==t.form.category.children.length},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):e("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ New Tag")])],2),e("el-form-item",{attrs:{label:"添加题图"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:3000/server/api/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[t.form.icon?e("img",{staticClass:"useravatar",attrs:{src:t.form.icon}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e("el-form-item",{attrs:{label:"文章内容",prop:"content","label-width":"80px"}},[e("vue-editor",{attrs:{useCustomImageHandler:""},on:{"image-added":t.handleImageAdded},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即发布")]),e("el-button",{staticStyle:{float:"right"},on:{click:t.cancle}},[t._v("清空")])],1)],1)],1)],1)},l=[],o=(i("14d9"),i("d000")),s=i("5873"),r={name:"Write",data(){return{mobile:!1,dialogVisible:!1,dialogVisible1:!1,rules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:2,max:30,message:"标题长度为2-30个字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"},{min:15,message:"文章内容不少于15个字",trigger:"blur"}]},options:[{value:"IT技术",label:"IT技术"},{value:"校园生活",label:"校园生活"},{value:"经验分享",label:"经验分享"},{value:"论坛提问",label:"论坛提问"}],inputVisible:!1,inputValue:"",form:{category:{value:"IT技术",children:[]},title:"",content:"",icon:""},logined:!0}},methods:{cancle(){this.$confirm("确定清空当前内容和草稿?","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.form.icon="",localStorage.form="",this.$refs.ruleForm.resetFields()}).catch(()=>{})},handleClose(t){this.form.category.children.splice(this.form.category.children.indexOf(t))},showInput(){this.inputVisible=!0,this.$nextTick(t=>{this.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm(){let t=this.inputValue;t&&this.form.category.children.push(t),this.inputVisible=!1,this.inputValue=""},handleAvatarSuccess(t){this.form.icon=t.url},async fetchData(){if(this.$store.state.admin){const{data:t}=await this.$http.put(""+this.$route.path);this.form=t}else{const{data:t}=await this.$http.get(""+this.$route.path);this.form=t}},beforeAvatarUpload(t){const e="image/jpeg"===t.type||"image/png"===t.type,i=t.size/1024/1024<=2;return e||this.$message.error("上传头像图片只能是 JPG或者PNG 格式!"),i||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&i},async onSubmit(){this.$refs.ruleForm.validate(async t=>{t&&this.$confirm("确定发布?","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{this.form.time=(new Date).getTime();await this.$http.post(""+this.$route.path,this.form);this.$message.success("修改成功"),this.form.icon="",localStorage.form="",this.$refs.ruleForm.resetFields(),this.$router.push("/")}).catch(()=>{})})},async handleImageAdded(t,e,i,a){if(t.size>=2306867.2)this.$message.error("图片大小不能超过2MB");else if("image/jpeg"!=t.type&&"image/jpg"!=t.type&&"image/png"!=t.type)this.$message.error("图片必须是JPG或者PNG格式");else{const l=new FormData;l.append("file",t);const o=await this.$http.post("upload",l);e.insertEmbed(i,"image",o.data.url),a()}}},components:{NavBar:o["a"],VueEditor:s["a"]},created(){window.innerWidth<=700?(this.mobile=!0,this.$message.warning("不建议在移动端发布或者修改文章")):this.mobile=!1,this.fetchData()},mounted(){localStorage.form&&(this.form=JSON.parse(localStorage.form))},beforeRouteLeave(t,e,i){(this.form.title||this.form.content)&&window.localStorage.setItem("form",JSON.stringify(this.form)),i()}},n=r,c=(i("41d7"),i("2877")),u=Object(c["a"])(n,a,l,!1,null,"afecf3e6",null);e["default"]=u.exports},"1ec3":function(t,e,i){},"41d7":function(t,e,i){"use strict";i("1ec3")}}]);